= JEP-0000: Remove commons-digester dependency from Jenkins Core
:toc: preamble
:toclevels: 3
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

.Metadata
[cols="1h,1"]
|===
| JEP
| 0000

| Title
| Remove commons-digester dependency from Jenkins Core

| Sponsor
| link:https://github.com/olamy[Olivier Lamy], link:https://github.com/bitwiseman[Liam Newman]

// Use the script `set-jep-status <jep-number> <status>` to update the status.
| Status
| Not Submitted :information_source:

| Type
| Informational

| Created
| (2021-05-07)

//
//
// Uncomment if there is an associated placeholder JIRA issue.
//| JIRA
//| :bulb: https://issues.jenkins-ci.org/browse/JENKINS-nnnnn[JENKINS-nnnnn] :bulb:
//
//
// Uncomment if discussion will occur in forum other than jenkinsci-dev@ mailing list.
//| Discussions-To
//| :bulb: Link to where discussion and final status announcement will occur :bulb:
//
//
// Uncomment if this JEP depends on one or more other JEPs.
//| Requires
//| :bulb: JEP-NUMBER, JEP-NUMBER... :bulb:
//
//
// Uncomment and fill if this JEP is rendered obsolete by a later JEP
//| Superseded-By
//| :bulb: JEP-NUMBER :bulb:
//
//
// Uncomment when this JEP status is set to Accepted, Rejected or Withdrawn.
//| Resolution
//| :bulb: Link to relevant post in the jenkinsci-dev@ mailing list archives :bulb:

|===

== Abstract

This JEP describes the steps taken to remove link:https://commons.apache.org/proper/commons-digester/[Apache Commons Digester] as a dependency of Jenkins Core. 

== Specification

Removing link:https://commons.apache.org/proper/commons-digester/[Apache Commons Digester] from Jenkins Core requires changes to Core and to a number of plugins. 
We will describe these two groups of changes separately.

=== Core

TODO: Describe the API exposed by Core that is being removed. What does the API provide. 
TODO: Note that Core does not use this API at all. 

=== Plugins

Plugins will need to be updated to avoid breaking during this change. 
The changes needed are relatively straightforward.
Assuming the dependency cannot be removed, the code changes needed are generally not complex. 
Most effected plugins 


==== Example change to plugin code

TODO: Example from PR

==== Effected plugins (fixes planned)


Below is a table of the effected plugins with PRs submitted to fix their breaks.  
These PRs may or may not be merged before removal is complete, depending on whether 
maintainers merge and release the submitted PRs.   

This table will be updated as needed to track the state of each plugin. 

Legend:

* :heavy_check_mark: - Fixed or no need to fix
* :stop_sign: 	     - It's not going to be fixed (no maintainer mainly)
* :exclamation: 	 - Waiting for something (merge or release)

[cols="1,1,4,1",options="header"]
|===
| Status                                                                                                         | Plugin                                                                         | Fix PR and/or status                                                                                                                                                                   | Number of OSS Installations 
| :heavy_check_mark:                                                                                             | https://github.com/jenkinsci/jelly                                             | only used by RSS Reader and core is producing RSS not reading it                                                                                                                       | infinity and beyond         
| :heavy_check_mark:                                                                                             | https://github.com/jenkinsci/jenkins-test-harness                              | Tests only                                                                                                                                                                             |                             
| :heavy_check_mark:  link:https://github.com/jenkinsci/subversion-plugin/releases/tag/subversion-2.14.1[2.14.1] |  link:https://github.com/jenkinsci/subversion-plugin[subversion]                   |  link:https://github.com/jenkinsci/subversion-plugin/pull/254[jenkinsci/subversion-plugin#254]                                                                                                                                                        | 170k                        
| :exclamation: merged, waiting for release                                                                      | link:https://github.com/jenkinsci/cvs-plugin[cvs]                                 |  link:https://github.com/jenkinsci/cvs-plugin/pull/55[jenkinsci/cvs-plugin#55]                                                                                                                                                                | 39k                         
| :heavy_check_mark: link:https://github.com/jenkinsci/maven-info-plugin/releases/tag/maven-info-0.3.0[0.3.0]    |  link:https://github.com/jenkinsci/maven-info-plugin[maven-info]                   |  link:https://github.com/jenkinsci/maven-info-plugin/pull/9[jenkinsci/maven-info-plugin#9] (last release 7 years ago)                                                                                                       | 5502                        
| :heavy_check_mark: link:https://github.com/jenkinsci/clover-plugin/releases/tag/clover-4.12.0[4.12.0]          |  link:https://github.com/jenkinsci/clover-plugin[clover]                           |  link:https://github.com/jenkinsci/clover-plugin/pull/24[jenkinsci/clover-plugin#24]                                                                                                                                     | 3521                        
| :stop_sign: (no maintainer)                                                                                    | link:https://github.com/jenkinsci/emma-plugin[emma]                               |  link:https://github.com/jenkinsci/emma-plugin/pull/11[jenkinsci/emma-plugin#11] (last real activity 6 years ago)                                                                                                      | 3216                        
| :stop_sign: (no maintainer)                                                                                    | link:https://github.com/jenkinsci/cloverphp-plugin[cloverphp]                     |  link:https://github.com/jenkinsci/cloverphp-plugin/pull/10[jenkinsci/cloverphp-plugin#10]  (last activity 6 years ago...)                                                                                                  | 2,801                       
| :heavy_check_mark: link:https://github.com/jenkinsci/clearcase-plugin/releases/tag/clearcase-1.6.7[1.6.7]         |  link:https://github.com/jenkinsci/clearcase-plugin[clearcase]                     |  link:https://github.com/jenkinsci/clearcase-plugin/pull/41[jenkinsci/clearcase-plugin#41]                                                                                                                                  | 2094                        
| :exclamation: maintainers answered                                                                             | link:https://github.com/jenkinsci/teamconcert-plugin[teamconcert]                 |  link:https://github.com/jenkinsci/teamconcert-plugin/pull/20[jenkinsci/teamconcert-plugin#20] (last activity/release early 2020)                                                                                             | 1640                        
| :exclamation: awaiting merge                                                                                   | link:https://github.com/jenkinsci/vs-code-metrics-plugin[vs-code-metrics]         |  link:https://github.com/jenkinsci/vs-code-metrics-plugin/pull/5[jenkinsci/vs-code-metrics-plugin#5] (last activity/release 2014)                                                                                                | 1435                        
| :stop_sign: (no maintainer)                                                                                    | link:https://github.com/jenkinsci/BlameSubversion-plugin[BlameSubversion]         |  link:https://github.com/jenkinsci/BlameSubversion-plugin/pull/5[jenkinsci/BlameSubversion-plugin#5]  (last activity 8 years ago...)                                                                                             | 878                         
| :stop_sign: (no maintainer)                                                                                    | link:https://github.com/jenkinsci/javatest-report-plugin[javatest-report]         |  link:https://github.com/jenkinsci/javatest-report-plugin/pull/4[jenkinsci/javatest-report-plugin#4] (last real activity 6 years ago)                                                                                            | 440                         
| :exclamation:  PR in active review, by @mig42                                                                  | link:https://github.com/jenkinsci/plasticscm-plugin[plasticscm-plugin]            |  link:https://github.com/jenkinsci/plasticscm-plugin/pull/40[jenkinsci/plasticscm-plugin#40] (last release late 2020, recent activity)                                                                                                               | 284                         
| :stop_sign: (maintainers will mark it for adoption)                                                            | link:https://github.com/jenkinsci/clearcase-ucm-plugin[clearcase-ucm]             |  link:https://github.com/jenkinsci/clearcase-ucm-plugin/pull/5[jenkinsci/clearcase-ucm-plugin#5] (last release 2016)                                                                                                                                   | 266                         
| :exclamation: awaiting release                                                                                 | link:https://github.com/jenkinsci/vectorcast-coverage-plugin[vectorcast-coverage] |  link:https://github.com/jenkinsci/vectorcast-coverage-plugin/pull/4[jenkinsci/vectorcast-coverage-plugin#4] (last release in 2021)                                                                                                                          | 206                         
| :heavy_check_mark: link:https://github.com/jenkinsci/zos-connector-plugin/releases/tag/zos-connector-2.3.5[2.3.5] |  link:https://github.com/jenkinsci/zos-connector-plugin[zos-connector]             |  link:https://github.com/jenkinsci/zos-connector-plugin/pull/13[jenkinsci/zos-connector-plugin#13] (recent activity in 2020)                                                                                                                            | 173                         
| :stop_sign: (no maintainer)                                                                                    | link:https://github.com/jenkinsci/vss-plugin[vss]                                 |  link:https://github.com/jenkinsci/vss-plugin/pull/8[jenkinsci/vss-plugin#8] (last release/activity 2011)                                                                                                                                    | 168                         
| :stop_sign: (no maintainer)                                                                                    | link:https://github.com/jenkinsci/genexus-plugin[genexus]                         |  link:https://github.com/jenkinsci/genexus-plugin/pull/15[jenkinsci/genexus-plugin#15] (activity Sept 2020 & release in April 2020)                                                                                       | 149                         
| :exclamation: awaiting release                                                                                 | link:https://github.com/jenkinsci/dimensionsscm-plugin[dimensionsscm]             |  link:https://github.com/jenkinsci/dimensionsscm-plugin/pull/21[jenkinsci/dimensionsscm-plugin#21]                                                                                                                                                      | 113                         
| :stop_sign: (no maintainer)                                                                                    | link:https://github.com/jenkinsci/synergy_scm-plugin[synergy]                     |  link:https://github.com/jenkinsci/synergy_scm-plugin/pull/17[jenkinsci/synergy_scm-plugin#17]) (last activity 6 years ago)                                                                                                                           | 96                          
| :stop_sign: (no maintainer, needed repo missed)                                                                | link:https://github.com/jenkinsci/config-rotator-plugin[config-rotator]           |  link:https://github.com/jenkinsci/config-rotator-plugin/pull/3[jenkinsci/config-rotator-plugin#3] (last activity 4 years ago)  :rotating_light: need help from Praqma, as https://code.praqma.net/repo/maven/ no longer exists | 62                          
| :stop_sign: (no maintainer)                                                                                    | link:https://github.com/jenkinsci/harvest-plugin[harvest]                         |  link:https://github.com/jenkinsci/harvest-plugin/pull/5[jenkinsci/harvest-plugin#5] (last activity 6 years ago)                                                                                                         | 49                          
| :exclamation: maintainers testing                                                                              | link:https://github.com/jenkinsci/plasticscm-mergebot-plugin[plasticscm-mergebot] |  link:https://github.com/jenkinsci/plasticscm-mergebot-plugin/pull/3[jenkinsci/plasticscm-mergebot-plugin#3]  (last active/release late 2019)                                                                                                                | 55                          
| :stop_sign: (no maintainer)                                                                                    | link:https://github.com/jenkinsci/cmvc-plugin[cmvc]                               |  link:https://github.com/jenkinsci/cmvc-plugin/pull/3[jenkinsci/cmvc-plugin#3]  (last activity 9 years ago...)                                                                                                                                | 18                          |
|===


==== Effected plugins (no fixes planned)

===== Suspended plugins

Some plugins were found which were suspended when Jenkins 2 was released. 
These will not be updated as part of this effort.  

* https://plugins.jenkins.io/svn-release-mgr suspended since https://issues.jenkins-ci.org/browse/INFRA-2487
* https://github.com/jenkinsci/cpptest-plugin suspended since https://issues.jenkins-ci.org/browse/INFRA-2487
* https://github.com/jenkinsci/tfs-plugin suspended since https://issues.jenkins-ci.org/browse/INFRA-2751
* https://github.com/jenkinsci/cflint-plugin (link:https://github.com/jenkinsci/CFLint-plugin/pull/3[PR-3]) suspended since https://issues.jenkins-ci.org/browse/INFRA-2751 
* https://github.com/jenkinsci/script-scm-plugin SECURITY-461
* https://github.com/jenkinsci/rtc-plugin (superseded by team-concert)


===== Never released plugins

Some plugins were found which were suspended when Jenkins 2 was released. 
These will not be updated as part of this effort.  

* https://github.com/jenkinsci/cocoemma-plugin
* https://github.com/jenkinsci/jwsdp-sqe-plugin
* https://github.com/jenkinsci/pucm-plugin
* https://github.com/jenkinsci/purecm-plugin


== Motivation

The link:https://commons.apache.org/proper/commons-digester/[Apache Commons Digester] that was included as a dependency of Jenkins Core is old and poorly maintained. 
It contains security vulnerabilities and also is not actually used by any part of Jenkins Core itself.
Jenkins Core exposes an API to plugin that mitigates some of these security issues, but it is not the job of Jenkins to do this. 
Instead, we should remove the Digester dependency from Jenkins Coret and the plugins that actually use Digester should handle these security concerns themselves.  
Also, because it is a dependency of Core, some plugins have taken a dependency on Digester being provided by Jenkins rather than using the API provided by Jenkins. 

Plugins in either of these scenarios will need to be updated or they will break after this removal. 

== Reasoning

=== Risks of complete removal

We chose to remove Digester from Jenkins Core in a manner that causes plugins which depend on it to fail unless they are updated.
We made this choice based on an analysis of all plugins which are currently distributed by the Jenkins Update Center or which are
in a repository in the link:https://github.com/jenkinsci[`jenkinsci` org on GitHub]. 
All but a few of the plugins effected by this change are some combination of unmaintained, rarely used, and no longer or never published.
We submitted PRs to all effected plugins. 


=== Detached plugin to maintain compatibility

The current plan causes plugins which depend on Jenkins to provide Digester to fail unless they are updated.
This could be mitigated by moving this dependency to a detached plugin. 
We decided against creating a detached pluging because there were a small number effected plugins and only a few of them have significant install base.
The creating and maintaining a detached plugin would still be a significant amount of work and would cause the security vulnerabilities we are trying to address to remain open.


== Backwards Compatibility

The current plan causes plugins which depend on Jenkins to provide Digester to fail unless they are updated.  
The majority of this JEP is devoted to discussion of how to mitigate these breaks. 


== Security

The motivation for this change is mitigating a number of known security issues 

== Infrastructure Requirements

There are no new infrastructure requirements related to this proposal.

== Testing

There are not testing issues related to this proposal. 

== Prototype Implementation

PRs filed 

== References

* link:https://commons.apache.org/proper/commons-digester/[Apache Commons Digester]
* link:https://issues.jenkins.io/browse/JENKINS-65161
* link:https://github.com/jenkinsci/jenkins/pull/5320[jenkinsci/jenkins#5320]
* link:https://groups.google.com/g/jenkinsci-dev/c/m2fEX5ALvbg/m/ZGeLMwcsBAAJ - Discussion of removal

